<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Place Order</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="/css/order-form.css">
	<link rel="stylesheet" href="/css/menu.css">
	<link rel="stylesheet" href="/css/flavor.css">
	<link rel="stylesheet" href="/css/addon.css">
	<link rel="stylesheet" href="/css/order.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
	<div class="container mt-3">
		<h1 class="text-center mb-4">Place Order</h1>
		<div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

		<!-- Categories Section -->
		<h3 class="section-title" onclick="toggleCategories()">
			Menu
			<span class="toggle-icon" id="categories-toggle">▼</span>
		</h3>
		<div class="collapsible-section categories-content" id="categories-container">
			<div class="category-container">
				<div th:each="menu : ${menu}" class="category-item">
					<button type="button" class="btn btn-outline-primary category-btn" th:text="${menu.name}"
						th:onclick="'loadItems(' + ${menu.id} + ')'"></button>
				</div>
			</div>
		</div>

		<!-- Flavors Section -->
		<h3 class="section-title">Flavors</h3>
		<div class="items-container" id="items-container">
			<div th:each="item : ${items}" class="item-item">
				<button type="button" class="item-btn" th:text="${item.name}" th:data-item-id="${item.id}"
					 onclick="addToOrder(this)"></button>
			</div>
		</div>

		<!-- Add-ons Section -->
		<h3 class="section-title">Add-ons</h3>
		<div class="addons-container">
			<div th:each="addon : ${addons}" class="col-md-4 mb-2">
				<div class="form-check">
					<input class="form-check-input addon-checkbox" type="checkbox" th:value="${addon.addonId}"
						th:id="'addon-'+${addon.addonId}" th:data-addon-price="${addon.price}"
						th:data-addon-name="${addon.addonName}" onchange="updateAddons()" />
					<label class="form-check-label" th:for="'addon-'+${addon.addonId}">
						<span th:text="${addon.addonName}"></span> - ₱<span th:text="${addon.price}"></span>
					</label>
				</div>
			</div>
		</div>

		<!-- Current Order Section -->
		<div class="order-container">
			<h3 class="section-title">Current Order</h3>
			<div class="order-summary" id="order-summary">
				<p class="text-center text-muted">No items yet</p>
			</div>

			<div class="d-flex justify-content-between align-items-center mt-4">
				<span class="order-total">Total: ₱<span id="order-total">0.00</span></span>
				<button class="btn btn-success btn-lg" type="button" onclick="confirmOrder()">
					Place Order
				</button>
			</div>
		</div>

		<!-- Variant Selection Modal -->
		<div class="modal fade" id="variantModal" tabindex="-1" aria-labelledby="variantModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="variantModalLabel">Select Variant</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body" id="variantModalBody">
				<!-- JS will inject variant buttons here -->
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-success" id="addVariantBtn">Add to Order</button>
			</div>
			</div>
		</div>
		</div>

		<!-- Hidden form for submission -->
		<form id="order-form" method="post" th:action="@{/order/confirm}">
			<input type="hidden" name="itemIds" id="itemIds" />
			<input type="hidden" name="quantities" id="quantities" />
			<input type="hidden" name="addonIds" id="addonIds" />
			<input type="hidden" name="addonQuantities" id="addonQuantities" />
		</form>
	</div>

	<script th:src="@{/js/order-state.js}"></script>
	<script th:src="@{/js/categories.js}"></script>
	<script th:src="@{/js/order-rendering.js}"></script>
	<script th:src="@{/js/order-operations.js}"></script>
	<script th:src="@{/js/items-loading.js}"></script>
	<script th:src="@{/js/event-handlers.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Order Confirmation Modal -->
	<div class="modal fade" id="orderConfirmModal" tabindex="-1" aria-labelledby="orderConfirmModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="orderConfirmModalLabel">
						Confirm Your Order
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<h6>Order Details</h6>
					<div id="modal-order-summary"></div>
					<div class="order-total mt-3">
						Total: ₱<span id="modal-order-total">0.00</span>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						Cancel
					</button>
					<button type="button" class="btn btn-success" onclick="submitConfirmedOrder()">
						Confirm Order
					</button>
				</div>
			</div>
		</div>
	</div>
</body>

</html>