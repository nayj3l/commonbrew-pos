<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Place Order</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="/css/order-form-default.css">
	<link rel="stylesheet" href="/css/menu.css">
	<link rel="stylesheet" href="/css/flavor.css">
	<link rel="stylesheet" href="/css/addon.css">
	<link rel="stylesheet" href="/css/order.css">
	<link rel="stylesheet" href="/css/item-form.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border-radius: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
            color: var(--dark);
            line-height: 1.6;
            /* padding-bottom: 80px; */
        }
        
        /* .container {
            max-width: 100%;
            padding: 16px;
        } */
        
        /* .app-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 16px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
         */
        /* .app-logo {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        } */
        
        /* .app-subtitle {
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
        } */
        
        /* Menu Section */
        .section-title {
            font-weight: 700;
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            /* background: white; */
            /* border-radius: var(--border-radius); */
            /* box-shadow: var(--shadow); */
            cursor: pointer;
        }
        
        .toggle-icon {
            font-size: 16px;
            transition: var(--transition);
            /* color: var(--primary); */
        }
        
        .toggle-icon.collapsed {
            transform: rotate(180deg);
        }
        
        .categories-content {
            margin-top: 12px;
            transition: var(--transition);
        }
        
        .categories-content.collapsed {
            display: none;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .category-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            text-decoration: none;
            color: var(--dark);
        }
        
        .category-btn:hover {
            border-color: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(67, 97, 238, 0.15);
        }
        
        .category-btn.selected {
            background: linear-gradient(135deg, #f0f7ff, #e1efff);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.15);
        }
        
        .category-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .category-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 576px) {
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .items-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .category-btn {
                min-height: 80px;
                padding: 12px 8px;
            }
            
            .category-icon {
                font-size: 20px;
            }
            
            .category-name {
                font-size: 12px;
            }
        }
        
        @media (min-width: 768px) {
            .category-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .items-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

    </style>
</head>

<body>
	<div class="order container mt-3">
		<h1 class="text-center mb-4">Place Order</h1>
		<div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

		<!-- Menu Section -->
		<div class="section-title" onclick="toggleCategories()">
			<span>Menu Categories</span>
			<span class="toggle-icon" id="categories-toggle">▼</span>
		</div>

		<!-- Menu List -->
		<div class="categories-content" id="categories-container">
			<div class="category-grid">
				<div th:each="menu : ${menu}" class="category-item">
					<a class="category-btn" th:text="${menu.name}" th:onclick="'loadItems(' + ${menu.id} + ')'">
						<div class="category-icon">
							<i class="fas fa-mug-hot"></i>
						</div>
						<div class="category-name" th:text="${menu.name}">Category Name</div>
					</a>
				</div>
			</div>
		</div>
	</div>


	<!-- Add-ons Section -->
	<!-- <h3 class="section-title">Add-ons</h3>
	<div class="addons-container">
		<div th:each="addon : ${addons}" class="col-md-4 mb-2">
			<div class="form-check">
				<input class="form-check-input addon-checkbox" type="checkbox" th:value="${addon.addonId}"
					th:id="'addon-'+${addon.addonId}" th:data-addon-price="${addon.price}"
					th:data-addon-name="${addon.addonName}" onchange="updateAddons()" />
				<label class="form-check-label" th:for="'addon-'+${addon.addonId}">
					<span th:text="${addon.addonName}"></span> - ₱<span th:text="${addon.price}"></span>
				</label>
			</div>
		</div>
	</div> -->

	<!-- Current Order Section -->
	<div class="order-container">
		<h3 class="section-title">Current Order</h3>
		<div class="order-summary" id="order-summary">
			<p class="text-center text-muted">No items yet</p>
		</div>

		<div class="d-flex justify-content-between align-items-center mt-4">
			<span class="order-total">Total: ₱<span id="order-total">0.00</span></span>
			<button class="btn btn-success btn-lg" type="button" onclick="confirmOrder()">
				Place Order
			</button>
		</div>
	</div>

	<!-- Variant Selection Modal -->
	<div class="modal fade " id="variantModal" tabindex="-1" aria-labelledby="variantModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-lg">
		<div class="modal-content">
		<div class="modal-header">
			<h5 class="modal-title" id="variantModalLabel">Select Variant</h5>
			<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body" id="variantModalBody">
			<!-- JS will inject variant buttons here -->
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
			<button type="button" class="btn btn-success" id="addVariantBtn">Add to Order</button>
		</div>
		</div>
	</div>
	</div>

	<!-- Hidden form for submission -->
	<form id="order-form" method="post" th:action="@{/order/confirm}">
		<input type="hidden" name="itemsVariantsIds" id="itemsVariantsIds" />
		<input type="hidden" name="quantities" id="quantities" />
		<input type="hidden" name="addonIds" id="addonIds" />
		<input type="hidden" name="addonQuantities" id="addonQuantities" />
	</form>

	<!-- Items Modal -->
	<div class="modal fade" id="itemsModal" tabindex="-1" aria-labelledby="itemsModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg" id="items-container">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="itemsModalLabel">Select Flavor</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body" id="itemsModalBody">
					<!-- JS will inject items here -->
				</div>
			</div>
		</div>
	</div>
	
	<script th:src="@{/js/order-state.js}"></script>
	<script th:src="@{/js/categories.js}"></script>
	<script th:src="@{/js/order-rendering.js}"></script>
	<script th:src="@{/js/order-operations.js}"></script>
	<script th:src="@{/js/items-loading.js}"></script>
	<script th:src="@{/js/event-handlers.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Order Confirmation Modal -->
	<div class="modal fade" id="orderConfirmModal" tabindex="-1" aria-labelledby="orderConfirmModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="orderConfirmModalLabel">
						Confirm Your Order
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body" id="variantModalBody">
					<h6>Order Details</h6>
					<div id="modal-order-summary"></div>
					<div class="order-total mt-3">
						Total: ₱<span id="modal-order-total">0.00</span>
					</div>
				</div>
				<div class="modal-footer" id="variantModalFooter">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						Cancel
					</button>
					<button type="button" class="btn btn-success" onclick="submitConfirmedOrder()">
						Confirm Order
					</button>
				</div>
			</div>
		</div>
	</div>

</body>

</html>