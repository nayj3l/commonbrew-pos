<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Place Order</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="/css/order-form-default.css">
	<link rel="stylesheet" href="/css/menu.css">
	<link rel="stylesheet" href="/css/flavor.css">
	<link rel="stylesheet" href="/css/addon.css">
	<link rel="stylesheet" href="/css/order.css">
	<link rel="stylesheet" href="/css/item-form.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border-radius: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
            color: var(--dark);
            line-height: 1.6;
            /* padding-bottom: 80px; */
        }
 
        /* Menu Section */
        .section-title {
            font-weight: 700;
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            /* background: white; */
            /* border-radius: var(--border-radius); */
            /* box-shadow: var(--shadow); */
            cursor: pointer;
        }
        
        .toggle-icon {
            font-size: 16px;
            /* transition: var(--transition); */
            /* color: var(--primary); */
        }
        
        .toggle-icon.collapsed {
            transform: rotate(180deg);
        }
        
        .categories-content {
            margin-top: 12px;
            /* transition: var(--transition); */
        }
        
        .categories-content.collapsed {
            display: none;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .category-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            /* transition: var(--transition); */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            text-decoration: none;
            color: var(--dark);
        }
        
        .category-btn:active  {
            border-color: var(--primary-light);
            /* transform: translateY(-3px); */
            box-shadow: 0 8px 16px rgba(67, 97, 238, 0.15);
        }
          
        .category-btn.selected {
            background: linear-gradient(135deg, #f0f7ff, #e1efff);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.15);
        }
        
        .category-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .category-name {
            font-weight: 600;
            font-size: 14px;
        }

        
        
        /* Responsive adjustments */
        @media (max-width: 576px) {
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .items-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .category-btn {
                min-height: 80px;
                padding: 12px 8px;
            }
            
            .category-icon {
                font-size: 20px;
            }
            
            .category-name {
                font-size: 12px;
            }
        }
        
        @media (min-width: 768px) {
            .category-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .items-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Modal adjustments */
#orderConfirmModal .modal-dialog {
    max-width: 95%;
    margin: 1.5rem auto;
}

#orderConfirmModal .modal-content {
    border-radius: 16px;
    padding: 0;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
}

/* Modal header */
#orderConfirmModal .modal-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
    padding: 20px;
    border-bottom: none;
}

#orderConfirmModal .modal-title {
    font-size: 20px;
    font-weight: 700;
}

#orderConfirmModal .btn-close {
    width: 32px;
    height: 32px;
}

/* Modal body */
#orderConfirmModal .modal-body {
    padding: 20px;
    font-size: 16px;
    line-height: 1.5;
}

#orderConfirmModal h6 {
    font-weight: 600;
    margin-bottom: 15px;
}

/* Order summary items */
#modal-order-summary {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 50vh;
    overflow-y: auto;
    padding-right: 5px; /* for scrollbar spacing */
}

.modal-order-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    border-radius: 12px;
    background: #f8f9fa;
    font-size: 16px;
    gap: 10px;
}

.modal-order-item .quantity-controls {
    display: flex;
    align-items: center;
    gap: 5px;
}

.modal-order-item .quantity-controls button {
    min-width: 36px;
    min-height: 36px;
    padding: 0;
    font-size: 18px;
    border-radius: 8px;
}

/* Total amount */
#orderConfirmModal .order-total {
    font-size: 18px;
    font-weight: 700;
    margin-top: 15px;
    padding: 12px;
    text-align: center;
    background: linear-gradient(135deg, #f0f7ff, #e1efff);
    border-radius: 12px;
}

/* Footer buttons */
#orderConfirmModal .modal-footer {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 15px 20px;
}

#orderConfirmModal .modal-footer .btn {
    font-size: 16px;
    padding: 14px 0;
    border-radius: 12px;
    width: 100%;
}

#orderConfirmModal .btn-success {
    background: linear-gradient(to right, var(--success), var(--primary));
    color: white;
}

#orderConfirmModal .btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(76, 201, 240, 0.3);
}

#orderConfirmModal .btn-secondary {
    background: white;
    color: var(--gray);
    border: 2px solid #e2e8f0;
}

#orderConfirmModal .btn-secondary:hover {
    background: #f8f9fa;
}

/* Scrollbar styling for mobile */
#modal-order-summary::-webkit-scrollbar {
    width: 6px;
}
#modal-order-summary::-webkit-scrollbar-thumb {
    background-color: rgba(67, 97, 238, 0.3);
    border-radius: 3px;
}

/* Responsive adjustments */
@media (max-width: 576px) {
    #orderConfirmModal .modal-body {
        font-size: 18px;
        padding: 15px;
    }

    #orderConfirmModal .modal-order-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }

    #orderConfirmModal .modal-footer {
        flex-direction: column;
        gap: 10px;
    }

    #orderConfirmModal .modal-footer .btn {
        font-size: 18px;
        padding: 16px 0;
    }
}

    .category-btn, .btn {
        will-change: transform;
        backface-visibility: hidden;
    }

    @media (hover: none) and (pointer: coarse) {
    .category-btn, .btn {
        transition: none !important;
        box-shadow: none !important;
    }

    .scrollable-container {
    -webkit-overflow-scrolling: touch; /* iOS smooth scrolling */
    touch-action: pan-y; /* Allow vertical scroll gestures only */
}

}

    </style>
</head>

<body>
<!-- Page Header -->
<div class="app-header d-flex justify-content-between align-items-center p-3 mb-4 shadow-sm rounded bg-white flex-wrap">
    <!-- Left: Dashboard -->
    <a href="/" class="btn btn-primary d-flex align-items-center gap-2 mb-2 mb-md-0 px-4 py-2">
        <i class="bi bi-house-fill"></i>
        Dashboard
    </a>

    <a href="/order/history" class="btn btn-outline-primary d-flex align-items-center gap-2 mb-2 mb-md-0 px-4 py-2">
        <i class="bi bi-card-list"></i>
        See All Orders
    </a>
</div>


<!-- Order Section -->
<div class="order container mt-4">
    <div class="card p-4 shadow-sm rounded">
        <h1 class="text-center mb-4 fw-bold">Place Order</h1>
        
		<!-- Menu Section -->
		<div class="section-title" onclick="toggleCategories()">
			<span>Menu Categories</span>
			<span class="toggle-icon" id="categories-toggle">â–¼</span>
		</div>

		<!-- Menu List -->
		<div class="categories-content" id="categories-container">
			<div class="category-grid">
				<div th:each="menu : ${menu}" class="category-item">
					<a class="category-btn" th:text="${menu.name}" th:onclick="'loadItems(' + ${menu.id} + ')'">
						<div class="category-icon">
							<i class="fas fa-mug-hot"></i>
						</div>
						<div class="category-name" th:text="${menu.name}">Category Name</div>
					</a>
				</div>
			</div>
		</div>
	</div>


	<!-- Add-ons Section -->
	<!-- <h3 class="section-title">Add-ons</h3>
	<div class="addons-container">
		<div th:each="addon : ${addons}" class="col-md-4 mb-2">
			<div class="form-check">
				<input class="form-check-input addon-checkbox" type="checkbox" th:value="${addon.addonId}"
					th:id="'addon-'+${addon.addonId}" th:data-addon-price="${addon.price}"
					th:data-addon-name="${addon.addonName}" onchange="updateAddons()" />
				<label class="form-check-label" th:for="'addon-'+${addon.addonId}">
					<span th:text="${addon.addonName}"></span> - â‚±<span th:text="${addon.price}"></span>
				</label>
			</div>
		</div>
	</div> -->

	<!-- Current Order Section -->
	<div class="order-container">
		<!-- <h3 class="section-title">Current Order</h3> -->
		<!-- <div class="order-summary" id="order-summary">
			<p class="text-center text-muted">No items yet</p>
		</div> -->

		<div class="d-flex justify-content-between align-items-center mt-4">
			<span class="order-total">Total: â‚±<span id="order-total">0.00</span></span>
			<button class="btn btn-success btn-lg" type="button" onclick="confirmOrder()">
				Place Order
			</button>
		</div>
	</div>

	<!-- Variant + Addons Selection Modal -->
<div class="modal fade" id="variantModal" tabindex="-1" aria-labelledby="variantModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            
            <!-- Modal Header -->
            <div class="modal-header" style="background: linear-gradient(135deg, #4361ee, #4895ef); color: white;">
                <h5 class="modal-title" id="variantModalLabel">Select Variant & Add-ons</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <!-- Variant Buttons -->
                <div id="variantModalBody" class="mb-4">
                    <!-- JS will inject variant buttons here -->
                </div>

                <hr class="w-75 mx-auto my-3">

                <!-- Addons Section -->
                <div id="addonOptions" class="row g-2">
                    <div class="col-6 col-md-4" th:each="addon : ${addons}">
                        <div class="form-check card p-2 text-center addon-card" style="border-radius:16px; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer;">
                            <input class="form-check-input position-static mx-auto" type="checkbox" 
                                   th:id="'addon-'+${addon.addonId}" 
                                   th:value="${addon.addonId}" 
                                   th:data-addon-price="${addon.price}"
                                   onchange="updateSelectedAddons()" />
                            <label class="form-check-label d-block mt-2" th:for="'addon-'+${addon.addonId}">
                                <span th:text="${addon.addonName}">Addon Name</span>
                                <br>
                                <small class="text-muted" th:text="'â‚±' + ${#numbers.formatDecimal(addon.price, 1, 2)}">â‚±0.00</small>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer d-flex flex-column flex-md-row gap-2">
                <button type="button" class="btn btn-secondary w-100 w-md-auto" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success w-100 w-md-auto" id="addVariantBtn" onclick="addVariantWithAddons()">
                    Add to Order
                </button>
            </div>
        </div>
    </div>
</div>

	<!-- Hidden form for submission -->
	<form id="order-form" method="post" th:action="@{/order/confirm}">
		<input type="hidden" name="itemsVariantsIds" id="itemsVariantsIds" />
		<input type="hidden" name="quantities" id="quantities" />
		<input type="hidden" name="addonIds" id="addonIds" />
		<input type="hidden" name="addonQuantities" id="addonQuantities" />
        <input type="hidden" name="addonItemIds" id="addonItemIds" />
        <input type="hidden" name="addonNames" id="addonNames" />
        <input type="hidden" name="addonVariants" id="addonVariants" />
	</form>

    <!-- Items Modal -->
    <div class="modal " id="itemsModal" tabindex="-1" aria-labelledby="itemsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" id="items-container">
            <div class="modal-content">
                
                <!-- Modal Header (title only) -->
                <div class="modal-header">
                    <h5 class="modal-title" id="itemsModalLabel">Select Flavor</h5>
                </div>

                <!-- Modal Body -->
                <div class="modal-body" id="itemsModalBody">
                    <!-- JS will inject items here -->
                </div>

                <!-- Modal Footer (close button) -->
                <div class="modal-footer">
                    <button type="button" class="btn-close-bottom" data-bs-dismiss="modal">
                        Close
                    </button>
                </div>

            </div>
        </div>
    </div>
	
	<script th:src="@{/js/order-state.js}"></script>
	<script th:src="@{/js/categories.js}"></script>
	<script th:src="@{/js/addons.js}"></script>
	<script th:src="@{/js/order-rendering.js}"></script>
	<script th:src="@{/js/order-operations.js}"></script>
	<script th:src="@{/js/items-loading.js}"></script>
	<script th:src="@{/js/event-handlers.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Order Confirmation Modal -->
	<div class="modal fade" id="orderConfirmModal" tabindex="-1" aria-labelledby="orderConfirmModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="orderConfirmModalLabel">
						Confirm Your Order
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body" id="variantModalBody">
					<h6>Order Details</h6>
					<div id="modal-order-summary"></div>
					<div class="order-total mt-3">
						Total: â‚±<span id="modal-order-total">0.00</span>
					</div>
				</div>
				<div class="modal-footer" id="variantModalFooter">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						Cancel
					</button>
					<button type="button" class="btn btn-success" onclick="submitConfirmedOrder()">
						Confirm Order
					</button>
				</div>
			</div>
		</div>
	</div>

</body>

</html>